{% extends 'app/base.html' %}
{% block content %}
<section class="pt-24 w-full h-full">
    <div class="container mx-auto">
        <section class="h-full w-full relative lg:pb-24 pb-16 md:mt-4">
            <div class="h-[20rem] w-full overflow-hidden rounded-md">
                <img src="{{ url_for('app.static', filename='app/img/pages.jpg') }}" class="object-cover object-center" alt="">
            </div>
            <div class="relative md:mt-24 mt-16 px-3">
                <div class="md:grid md:grid-cols-[15rem_1fr] lg:grid-cols-[20rem_1fr]">
                    <div class="w-full md:px-3">
                        <div class="relative md:-mt-48 -mt-32">
                            <div class="p-6 rounded-md shadow dark:shadow-gray-800 bg-white dark:bg-slate-900">
                                <div
                                class="text-center mb-5"
                                x-data="profileImageHandler()"
                                >
                                    <input id="pro-img" name="profile-image" type="file" class="hidden" @change="uploadProfileImage">
                                    <div>
                                        <div class="relative size-28 mx-auto">
                                            <img :src="profileImageUrl" class="rounded-full shadow dark:shadow-gray-800 ring-4 ring-slate-50 dark:ring-slate-800" id="profile-image" alt="">
                                            <label class="absolute inset-0 cursor-pointer" for="pro-img"></label>
                                        </div>
                                        <div class="mt-4">
                                            <h5 class="text-lg font-semibold">{{ current_user.get_full_name() }}</h5>
                                            <p class="text-slate-400">{{ current_user.email }}</p>
                                        </div>
                                    </div>
                                </div>
        
                                <div class="border-t border-gray-100 dark:border-gray-700">
                                    <div class="mb-0 pb-0">
                                        <div class="">
                                            <a href="{{ url_for('app.account') }}" class="text-slate-400 flex items-center py-2 rounded hover:text-primary link-active">
                                                <span class="me-2 mb-0"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-airplay size-4"><path d="M5 17H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-1"></path><polygon points="12 15 17 21 7 21 12 15"></polygon></svg></span>
                                                <h6 class="mb-0 font-medium">Account</h6>
                                            </a>
                                        </div>
        
                                        <div class="">
                                            <a href="{{ url_for('app.billing') }}" class="text-slate-400 flex items-center py-2 rounded hover:text-primary">
                                                <span class="me-2 mb-0"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit size-4"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg></span>
                                                <h6 class="mb-0 font-medium">Billing Info</h6>
                                            </a>
                                        </div>
        
                                        <div class="">
                                            <a href="{{ url_for('app.payment') }}" class="text-slate-400 flex items-center py-2 rounded hover:text-primary">
                                                <span class="me-2 mb-0"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-credit-card size-4"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect><line x1="1" y1="10" x2="23" y2="10"></line></svg></span>
                                                <h6 class="mb-0 font-medium">Payment</h6>
                                            </a>
                                        </div>
        
                                        <div class="">
                                            <a href="" class="text-slate-400 flex items-center py-2 rounded hover:text-primary">
                                                <span class="me-2 mb-0"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text size-4"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg></span>
                                                <h6 class="mb-0 font-medium">Invoice</h6>
                                            </a>
                                        </div>
        
                                        <div class="">
                                            <a href="{{ url_for('app.social') }}" class="text-slate-400 flex items-center py-2 rounded hover:text-primary">
                                                <span class="me-2 mb-0"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-share-2 size-4"><circle cx="18" cy="5" r="3"></circle><circle cx="6" cy="12" r="3"></circle><circle cx="18" cy="19" r="3"></circle><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line></svg></span>
                                                <h6 class="mb-0 font-medium">Social Profile</h6>
                                            </a>
                                        </div>
        
                                        <div class="">
                                            <a href="" class="text-slate-400 flex items-center py-2 rounded hover:text-primary">
                                                <span class="me-2 mb-0"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-bell size-4"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></svg></span>
                                                <h6 class="mb-0 font-medium">Notifications</h6>
                                            </a>
                                        </div>
        
                                        <div class="">
                                            <a href="{{ url_for('app.settings') }}" class="text-slate-400 flex items-center py-2 rounded hover:text-primary">
                                                <span class="me-2 mb-0"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-settings size-4"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg></span>
                                                <h6 class="mb-0 font-medium">Settings</h6>
                                            </a>
                                        </div>
        
                                        <div class="">
                                            <a href="" class="text-slate-400 flex items-center py-2 rounded hover:text-primary">
                                                <span class="me-2 mb-0"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-log-out size-4"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg></span>
                                                <h6 class="mb-0 font-medium">Sign Out</h6>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- second section -->
                     {% block content2 %} 
                     <div class="w-full md:px-3 mt-6 md:mt-0">
                         <h5 class="text-lg font-semibold mb-6">My Orders</h5>
                         <div class="relative overflow-x-auto shadow dark:shadow-gray-800 rounded-md">
                             <table class="w-full text-start text-slate-500 dark:text-slate-400">
                                 <thead class="text-sm uppercase bg-slate-50 dark:bg-slate-800">
                                     <tr class="text-start">
                                         <th scope="col" class="px-2 py-3 text-start">Order no.</th>
                                         <th scope="col" class="px-2 py-3 text-start">Date</th>
                                         <th scope="col" class="px-2 py-3 text-start">Status</th>
                                         <th scope="col" class="px-2 py-3 text-start">Total</th>
                                         <th scope="col" class="px-2 py-3 text-start">Action</th>
                                     </tr>
                                 </thead>
                                 <tbody>
                                     <tr class="bg-white dark:bg-slate-900 text-start">
                                         <th class="px-2 py-3 text-start" scope="row">7107</th>
                                         <td class="px-2 py-3 text-start">1st November 2021</td>
                                         <td class="px-2 py-3 text-start text-green-600">Delivered</td>
                                         <td class="px-2 py-3 text-start">$ 320 <span class="text-slate-400">for 2items</span></td>
                                         <td class="px-2 py-3 text-start"><a href="javascript:void(0)" class="text-orange-500">View <i class="mdi mdi-chevron-right"></i></a></td>
                                     </tr>
         
                                     <tr class="bg-white dark:bg-slate-900 text-start border-t border-gray-100 dark:border-gray-700">
                                         <th class="px-2 py-3 text-start" scope="row">8007</th>
                                         <td class="px-2 py-3 text-start">4th November 2021</td>
                                         <td class="px-2 py-3 text-start text-slate-400">Processing</td>
                                         <td class="px-2 py-3 text-start">$ 800 <span class="text-slate-400">for 1item</span></td>
                                         <td class="px-2 py-3 text-start"><a href="javascript:void(0)" class="text-orange-500">View <i class="mdi mdi-chevron-right"></i></a></td>
                                     </tr>
         
                                     <tr class="bg-white dark:bg-slate-900 text-start border-t border-gray-100 dark:border-gray-700">
                                         <th class="px-2 py-3 text-start" scope="row">8008</th>
                                         <td class="px-2 py-3 text-start">4th November 2021</td>
                                         <td class="px-2 py-3 text-start text-red-600">Canceled</td>
                                         <td class="px-2 py-3 text-start">$ 800 <span class="text-slate-400">for 1item</span></td>
                                         <td class="px-2 py-3 text-start"><a href="javascript:void(0)" class="text-orange-500">View <i class="mdi mdi-chevron-right"></i></a></td>
                                     </tr>
                                 </tbody>
                             </table>
                         </div>
         
                         <h5 class="text-lg font-semibold my-6">My favourite Items</h5>
         
                         <div class="rounded-md shadow dark:shadow-gray-800 p-6">
                             <ul>
                                 <li class="flex justify-between items-center pb-6">
                                     <div class="flex items-center">
                                         <img src="{{ url_for('app.static', filename='app/img/shop/apple-smart-watch.jpg') }}" class="rounded shadow dark:shadow-gray-800 w-16" alt="">
         
                                         <div class="ms-4">
                                             <a href="" class="font-semibold hover:text-orange-500">Apple Smart Watch</a>
                                             <p class="text-green-600 text-sm mt-1">$16.00 <del class="text-red-600">$21.00</del></p>
                                         </div>
                                     </div>
         
                                     <div>
                                         <a href="" class="size-9 inline-flex items-center justify-center tracking-wide align-middle duration-500 text-base text-center bg-red-600/5 hover:bg-red-600 text-red-600 hover:text-white rounded-full"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-trash-2 h-4 w-4"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg></a>
                                     </div>
                                 </li>
         
                                 <li class="flex justify-between items-center py-6 border-t border-gray-100 dark:border-gray-700">
                                     <div class="flex items-center">
                                         <img src="{{ url_for('app.static', filename='app/img/shop/ladies-2.jpg') }}" class="rounded shadow dark:shadow-gray-800 w-16" alt="">
         
                                         <div class="ms-4">
                                             <a href="" class="font-semibold hover:text-orange-500">Ladies Top</a>
                                             <p class="text-green-600 text-sm mt-1">$16.00 <del class="text-red-600">$21.00</del></p>
                                         </div>
                                     </div>
         
                                     <div>
                                         <a href="" class="size-9 inline-flex items-center justify-center tracking-wide align-middle duration-500 text-base text-center bg-red-600/5 hover:bg-red-600 text-red-600 hover:text-white rounded-full"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-trash-2 h-4 w-4"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg></a>
                                     </div>
                                 </li>
         
                                 <li class="flex justify-between items-center pt-6 border-t border-gray-100 dark:border-gray-700">
                                     <div class="flex items-center">
                                         <img src="{{ url_for('app.static', filename='app/img/shop/ladies-sun-glasses.jpg') }}" class="rounded shadow dark:shadow-gray-800 w-16" alt="">
         
                                         <div class="ms-4">
                                             <a href="" class="font-semibold hover:text-orange-500">Ladies Sunglasses</a>
                                             <p class="text-green-600 text-sm mt-1">$16.00 <del class="text-red-600">$21.00</del></p>
                                         </div>
                                     </div>
         
                                     <div>
                                         <a href="" class="size-9 inline-flex items-center justify-center tracking-wide align-middle duration-500 text-base text-center bg-red-600/5 hover:bg-red-600 text-red-600 hover:text-white rounded-full"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-trash-2 h-4 w-4"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg></a>
                                     </div>
                                 </li>
                             </ul>
                         </div>
                     </div>
                     {% endblock %}
                </div>
            </div>
        </section>
    </div>
</section>
<script>
    function profileImageHandler() {
        return {
            profileImageUrl: "{{ current_user.get_profile_picture_url() }}",  // Default profile image path

            // Function to handle the profile image upload
            uploadProfileImage(event) {
                const file = event.target.files[0];  // Get the uploaded file
                if (!file) return;

                // Prepare the form data
                const formData = new FormData();
                formData.append('profile-picture', file);
                formData.append('action', 'picture-form');
                formData.append('csrf_token', '{{ csrf_token() }}');

                // Send the file to the backend via an AJAX request
                fetch('/update_profile_image', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        // Update the profile image URL to reflect the uploaded image
                        this.profileImageUrl = data.image_url;
                    } else {
                        console.error(data.message);
                    }
                })
                .catch(error => {
                    console.error('Error uploading image:', error);
                });
            }
        }
    }

</script>
{% endblock %}