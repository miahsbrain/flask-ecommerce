{% extends 'app/base.html' %}
{% block content %}
<section class="pt-24 w-full h-full">
    <section class="relative table w-full py-20 lg:py-24 md:pt-28 bg-gray-200 dark:bg-slate-800">
        <div class="container mx-auto relative">
            <div class="grid grid-cols-1 mt-14">
                <h3 class="text-3xl leading-normal font-semibold">Fashion</h3>
            </div><!--end grid-->

            <div class="relative mt-3">
                <div class="tracking-[0.5px] mb-0 inline-block">
                    <div
                        class="inline-block uppercase text-[13px] font-bold duration-300 ease-in-out hover:text-orange-500">
                        <a href="">Cartzio</a>
                    </div>
                    <div
                        class="inline-block text-base text-slate-950 dark:text-white mx-0.5 ltr:rotate-0 rtl:rotate-180">
                        &rarr;</div>
                    <div class="inline-block uppercase text-[13px] font-bold text-orange-500" aria-current="page">Shop Detail</div>
                </div>
            </div>
        </div>
    </section>
    <!-- Detail -->
    

    <section class="relative md:py-24 py-16" x-data="productDetail()" x-init="init()">
        <div class="container relative px-3 mx-auto">
            <div class="grid md:grid-cols-2 grid-cols-1 gap-6 items-center">
                <div class="">
                    <div class="product-imgs flex">
                        <div class="w-1/6">
                            <div class="">
                                <div class="p-px">
                                    {% for variation in product.variations %}
                                        {% for img in variation.images %}  
                                        <div @click="changeCurrentImage('{{ img }}')" class="mb-1 last-of-type:mb-0">
                                            <img src="{{ img }}" class="shadow dark:shadow-gray-800 w-full h-auto" alt="">
                                        </div>
                                        {% endfor %}
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                        <div class="img-display shadow dark:shadow-gray-800 m-px w-5/6">
                            <div class="img-showcase flex w-full duration-500">
                                <img :src="currentImage" class="min-w-full" alt="{{ product.name }}">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="sticky top-20">
                    <h5 class="text-2xl font-semibold">{{ product.name }}</h5>
                    <div class="mt-2"><span class="text-slate-400 font-semibold me-1" x-text="'$ '+price+' USD'">
                        <del class="text-red-600">$21USD</del></span>
                        <!-- Rating -->
                        <ul class="list-none inline-block text-orange-400">
                            <li class="inline"><i class="mdi mdi-star text-lg"></i></li>
                            <li class="inline"><i class="mdi mdi-star text-lg"></i></li>
                            <li class="inline"><i class="mdi mdi-star text-lg"></i></li>
                            <li class="inline"><i class="mdi mdi-star text-lg"></i></li>
                            <li class="inline"><i class="mdi mdi-star text-lg"></i></li>
                            <li class="inline text-slate-400 font-semibold">4.8 (45)</li>
                        </ul>
                    </div>
                    <div class="mt-4">
                        <h5 class="text-lg font-semibold">Overview:</h5>
                        <p class="text-slate-400 mt-2">{{ product.description }}</p>
                        <!-- <ul class="list-none text-slate-400 mt-4">
                            <li class="mb-1 flex ms-0"><i class="mdi mdi-check-circle-outline text-orange-500 text-xl me-2"></i>
                                Digital Marketing Solutions for Tomorrow</li>
                            <li class="mb-1 flex ms-0"><i class="mdi mdi-check-circle-outline text-orange-500 text-xl me-2"></i>
                                Our Talented &amp; Experienced Marketing Agency</li>
                            <li class="mb-1 flex ms-0"><i class="mdi mdi-check-circle-outline text-orange-500 text-xl me-2"></i>
                                Create your own skin to match your brand</li>
                        </ul> -->
                    </div>
                    <div class="grid lg:grid-cols-2 grid-cols-1 gap-6 mt-4">
                        <div class="flex items-center">
                            <h5 class="text-lg font-semibold me-2">Size:</h5>
                            <div class="space-x-1">
                                <!-- Color Filter with Radio Buttons -->
                                <template x-for="size in uniqueSizes" :key="size">
                                    <label class="radio-label">
                                        <input type="radio" name="size" :value="size" @change="filterColors(size)" :checked="size === selectedSize" class="hidden peer">
                                        <div class="size-9 inline-flex items-center justify-center tracking-wide align-middle text-base text-center rounded-md bg-orange-500/5 hover:bg-orange-500 text-orange-500 hover:text-white peer-checked:bg-green-500" x-text="size"></div>
                                    </label>
                                </template>
                            </div>
                        </div>
                        <div class="flex items-center">
                            <h5 class="text-lg font-semibold me-2">Quantity:</h5>
                            <div class="ms-3 space-x-0.5">
                                <button class="size-9 inline-flex items-center justify-center tracking-wide align-middle text-base text-center rounded-md bg-orange-500/5 hover:bg-orange-500 text-orange-500 hover:text-white minus" @click="updateQuantity('neg')">-</button>
                                <input min="0" name="quantity" type="number" :value="selectedQuantity" class="size-9 inline-flex items-center justify-center tracking-wide align-middle text-base text-center rounded-md bg-orange-500/5 hover:bg-orange-500 text-orange-500 hover:text-white pointer-events-none w-16 ps-4">
                                <button class="size-9 inline-flex items-center justify-center tracking-wide align-middle text-base text-center rounded-md bg-orange-500/5 hover:bg-orange-500 text-orange-500 hover:text-white plus" @click="updateQuantity('pos')">+</button>
                            </div>
                        </div>
                        <div class="flex items-center">
                            <h5 class="text-lg font-semibold me-2">Colors:</h5>
                            <div class="space-x-2">
                                <!-- Color Filter with Radio Buttons (Not Filtered) -->
                                <template x-for="color in uniqueColors" :key="color">
                                    <label class="radio-label">
                                        <input type="radio" name="color" :value="color" @change="filterSizes(color)" :checked="color === selectedColor" class="hidden peer">
                                        <div class="size-6 rounded-full ring-2 ring-gray-200 dark:ring-slate-800 bg-red-600 inline-flex align-middle peer-checked:bg-green-500" x-text="color"></div>
                                    </label>
                                </template>
                            </div>
                        </div>
                    </div>
                    <div class="mt-4 space-x-1">
                        <a class="py-2 px-5 inline-block font-semibold tracking-wide align-middle text-base text-center bg-orange-500 text-white rounded-md mt-2" href="">Shop Now</a>
                        <a class="py-2 px-5 inline-block font-semibold tracking-wide align-middle text-base text-center rounded-md bg-orange-500/5 hover:bg-orange-500 text-orange-500 hover:text-white mt-2" href="">Add to Cart</a>
                    </div>
                </div>
            </div>
            <div class="grid md:grid-cols-12 grid-cols-1 mt-6 gap-6">
                <div class="lg:col-span-3 md:col-span-5">
                    <div class="sticky top-20">
                        <ul class="flex-column p-6 bg-white dark:bg-slate-900 shadow dark:shadow-gray-800 rounded-md" id="myTab"
                            data-tabs-toggle="#myTabContent" role="tablist">
                            <li class="ms-0"><button
                                    class="px-4 py-2 text-start text-base font-semibold rounded-md w-full hover:bg-orange-500 duration-500 text-white bg-orange-500 hover:text-white">Description</button>
                            </li>
                            <li class="ms-0"><button
                                    class="px-4 py-2 text-start text-base font-semibold rounded-md w-full hover:text-orange-500 duration-500 ">Additional
                                    Information</button></li>
                            <li class="ms-0"><button
                                    class="px-4 py-2 text-start text-base font-semibold rounded-md w-full hover:text-orange-500 duration-500 ">Review</button>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="lg:col-span-9 md:col-span-7">
                    <div id="myTabContent" class="p-6 bg-white dark:bg-slate-900 shadow dark:shadow-gray-800 rounded-md">
                        <div>
                            <p class="text-slate-400">Due to its widespread use as filler text for layouts, non-readability is of great importance: human perception is tuned to recognize certain patterns and repetitions in texts. If the distribution of letters and 'words' is random, the reader will not be distracted from making a (typography), or the distribution of text on the page (layout or type area). For this reason, dummy text usually consists of a more or less random series of words or syllables.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>

    </section>



<script>
    const product = {{ product | tojson | safe }};
    console.log(product);
    function productDetail() {
        return {
            product: product,
            currentImage: product.variations[0].images[0],  // Default big image
            selectedQuantity: parseInt(1),

            selectedColor: product.variations[0].color,   // Default selected color
            selectedSize: product.variations[0].size, // Default selected size
            uniqueColors: [],    // Colors available (no filtering)
            uniqueSizes: [],     // Sizes filtered by selected color
            price: product.variations[0].price,

            changeCurrentImage(img) {
                this.currentImage = img
            },

            updateQuantity(arg) {
                if (arg == 'neg') {
                    this.selectedQuantity = parseInt(Math.max(1, this.selectedQuantity - 1))
                }
                if (arg == 'pos') {
                    this.selectedQuantity = parseInt(Math.min(10, this.selectedQuantity + 1))
                }
            },

            init() {
                this.uniqueColors = this.getUniqueColors();
                this.filterSizes(this.selectedColor); // Filter sizes based on the default color
            },

            // Get all unique colors (No filtering required here)
            getUniqueColors() {
                return [...new Set(this.product.variations.map(v => v.color))];
            },

            // Get all unique sizes available for the current selected color
            getUniqueSizes() {
                const filtered = this.selectedColor
                    ? this.product.variations.filter(v => v.color === this.selectedColor)
                    : this.product.variations;
                return [...new Set(filtered.map(v => v.size))];
            },

            // Filter sizes when a color is selected
            filterSizes(color) {
                this.selectedColor = color;
                this.uniqueSizes = this.getUniqueSizes();

                // Reset size if it's not in the new filtered list
                if (!this.uniqueSizes.includes(this.selectedSize)) {
                    this.selectedSize = this.uniqueSizes[0]; // Set the first available size if current one is not valid
                }
                
                this.updateImage();
            },
            
            // Filter colors when a size is selected (No actual filtering, but just handling change)
            filterColors(size) {
                this.selectedSize = size;
            },

            // Update the image based on the selected color and size
            updateImage() {
                const variation = this.product.variations.find(v => v.color === this.selectedColor && v.size === this.selectedSize);
                if (variation) {
                    this.currentImage = variation.images[0];
                    this.price = variation.price
                }
            }

        };
    }
</script>
</section>
{% endblock %}